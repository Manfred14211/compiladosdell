@model IEnumerable<iveCincoFrame.Models.Metas.ObjRespuestaMetas>
@{
    ViewBag.Title = "IndexMetaEmleados";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<script src="https://cdn.jsdelivr.net/gh/linways/table-to-excel@v1.0.4/dist/tableToExcel.js"></script>
<div class="row">
    @Html.Partial("_MensajeParcial")

    <div class="col-12">
        <div class="card">
            <div class="card-header mb-0">
                <div class="container text-center">
                    <h1 class="text-primary" style="color: #0c4899 !important;">Conteo de Desembolsos por Ejecutivo</h1>

                    <h4 class="card-subtitle text-muted">
                        Detalles del reporte:
                    </h4>
                    <hr />
                </div>
            </div>
            <div class="card-body">
                <button id="btnExport" class="btn btn-success" onclick="exportReportToExcel(this)">EXPORTA EXCEL</button>
                <br />
                <div class="" id="contenido-tabla" style="overflow: scroll; height: 800px;">
                    <table id="tblMetasEmpleados" class="table table-bordered table-sm">
                        <thead class="table-dark">


                            <tr>
                                <td class="small">Region<span style="color:#153d77;">.............................</span></td>
                                <td class="small">Sucursal<span style="color:#153d77;">.............................................................</span></td>
                                <td class="small">Ejecutivo<span style="color:#153d77;">.............................................................................................................................</span></td>
                                @foreach (var item in @ViewBag.Fechas)
                                {
                                    <td class="small">@item</td>

                                }

                            </tr>

                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Region)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Sucursal)
                                    </td>
                                    @*<td>
                                        <a href="@Url.Action("GetraficasEmpleado/"+ item.empleado,"Metas")" class="btn btn-light">@Html.DisplayFor(modelItem => item.Ejecutivo)</a>
                                    </td>*@
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Ejecutivo)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY1)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY2)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY3)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY4)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY5)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY6)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY7)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY8)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY9)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY10)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY11)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY12)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY13)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY14)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY15)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY16)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY17)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY18)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY19)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY20)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY21)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY22)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY23)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY24)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY25)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY26)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY27)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY28)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY29)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY30)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.HOY31)
                                    </td>
                                </tr>
                            }
                        </tbody>
                        <tfoot align="left" class="table-dark">
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    function exportReportToExcel() {
        let table = document.getElementsByTagName("table"); // you can use document.getElementById('tableId') as well by providing id to the table tag
        TableToExcel.convert(table[0], { // html code may contain multiple tables so here we are refering to 1st table tag
            name: `Archivo.xlsx`, // fileName you could use any name
            sheet: {
                name: 'Sheet 1' // sheetName
            }
        });
    }
    $(document).ready(function () {
        $("#btnExport").click(function () {
            let table = document.getElementsByTagName("tblMetasEmpleados");
            TableToExcel.convert(table[0], { // html code may contain multiple tables so here we are refering to 1st table tag
                name: `Archivo.xlsx`, // fileName you could use any name
                sheet: {
                    name: 'Sheet 1' // sheetName
                }
            });
        });
    });

    $(document).ready(function () {

        $('#tblMetasEmpleados').DataTable({
            language: {
                "decimal": "",
                "emptyTable": "No hay información",
                "info": "",
                "infoEmpty": "",
                "infoFiltered": "",
                "infoPostFix": "",
                "thousands": ",",
                "lengthMenu": "",
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "Buscar:",
                "zeroRecords": "Sin resultados encontrados",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                }
            },
            //responsive: true,
            pageLength: 300,
            footerCallback: function (tfoot, data, start, end, display) {
                var api = this.api(), data;

                // Remove the formatting to get integer data for summation
                var intVal = function (i) {
                    return typeof i === 'string' ?
                        i.replace(/[\Q,]/g, '') * 1 :
                        typeof i === 'number' ?
                            i : 0;
                };
                // computing column Total of the complete result
                var HOY = api
                    .column(3)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b)
                    }, 0);

                //console.log(HOY);


                var HOY1 = api
                    .column(4)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY2 = api
                    .column(5)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY3 = api
                    .column(6)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY4 = api
                    .column(7)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY5 = api
                    .column(8)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY6 = api
                    .column(9)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY7 = api
                    .column(10)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY8 = api
                    .column(11)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY9 = api
                    .column(12)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY10 = api
                    .column(13)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY11 = api
                    .column(14)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                var HOY12 = api
                    .column(15)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY13 = api
                    .column(16)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY14 = api
                    .column(17)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY15 = api
                    .column(18)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY16 = api
                    .column(19)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY17 = api
                    .column(20)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY18 = api
                    .column(21)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY19 = api
                    .column(22)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY20 = api
                    .column(23)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY21 = api
                    .column(24)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY22 = api
                    .column(25)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY23 = api
                    .column(26)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY24 = api
                    .column(27)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY25 = api
                    .column(28)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY26 = api
                    .column(29)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY27 = api
                    .column(30)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY28 = api
                    .column(31)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY29 = api
                    .column(32)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY30 = api
                    .column(33)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);
                var HOY31 = api
                    .column(34)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);


                //const formateador = new Intl.NumberFormat("en", { style: "currency", "currency": "GTQ" });


                $(api.column(0).footer()).html('Total');
                $(api.column(3).footer()).html(HOY);
                $(api.column(4).footer()).html(HOY1);
                $(api.column(5).footer()).html(HOY2);
                $(api.column(6).footer()).html(HOY3);
                $(api.column(7).footer()).html(HOY4);
                $(api.column(8).footer()).html(HOY5);
                $(api.column(9).footer()).html(HOY6);
                $(api.column(10).footer()).html(HOY7);
                $(api.column(11).footer()).html(HOY8);
                $(api.column(12).footer()).html(HOY9);
                $(api.column(13).footer()).html(HOY10);
                $(api.column(14).footer()).html(HOY11);

                $(api.column(15).footer()).html(HOY12);
                $(api.column(16).footer()).html(HOY13);
                $(api.column(17).footer()).html(HOY14);
                $(api.column(18).footer()).html(HOY15);
                $(api.column(19).footer()).html(HOY16);
                $(api.column(20).footer()).html(HOY17);
                $(api.column(21).footer()).html(HOY18);
                $(api.column(22).footer()).html(HOY19);
                $(api.column(23).footer()).html(HOY20);
                $(api.column(24).footer()).html(HOY21);
                $(api.column(25).footer()).html(HOY22);
                $(api.column(26).footer()).html(HOY23);
                $(api.column(27).footer()).html(HOY24);
                $(api.column(28).footer()).html(HOY25);

                $(api.column(29).footer()).html(HOY26);
                $(api.column(30).footer()).html(HOY27);
                $(api.column(31).footer()).html(HOY28);
                $(api.column(32).footer()).html(HOY29);
                $(api.column(33).footer()).html(HOY30);
                $(api.column(34).footer()).html(HOY31);


            },
            "fnRowCallback": function (row, data, nTd) {



                function setColors(number) {
                    if (data[number] == 0 || data[number] == "0") //si la edad es menor de 40
                    {
                        //$('td', nRow).css('background-color', '#F44336');
                        $($(row).find("td")[number]).css("background-color", "#e53935");
                        $($(row).find("td")[number]).css("color", "#fafafa");

                    }
                    else {
                        $($(row).find("td")[number]).css("background-color", "#43a047");
                        $($(row).find("td")[number]).css("color", "#1f1e28");
                    }
                }

                for (var i = 3; i <= 34; i++) {
                    setColors(i);
                }
                //else if (data[3] >= 1)
                //{
                //    //$('td', nRow).css('background-color', '#F44336');
                //    $($(row).find("td")[3]).css("background-color", "#fbc02d");
                //    $($(row).find("td")[3]).css("color", "#1f1e28");
                //}
                //else if (data[3] >= 5)
                //{
                //    //$('td', nRow).css('background-color', '#F44336');
                //    $($(row).find("td")[3]).css("background-color", "#43a047");
                //    $($(row).find("td")[3]).css("color", "#1f1e28");
                //}
            }

        });

    });
    //var dataTable;

    //$(document).ready(function () {




    //    loadDataTable();



    //});


    //function loadDataTable() {
    //    dataTable = $('#tblMetasEmpleados').DataTable({
    //        "footerCallback": function (tfoot, data, start, end, display) {
    //            var api = this.api(), data;

    //            // Remove the formatting to get integer data for summation
    //            var intVal = function (i) {
    //                return typeof i === 'string' ?
    //                    i.replace(/[\Q,]/g, '') * 1 :
    //                    typeof i === 'number' ?
    //                        i : 0;
    //            };



    //            // computing column Total of the complete result
    //            var HOY = api
    //                .column(3)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return parseFloat(a) + parseFloat(b)
    //                }, 0);

    //            //console.log(HOY);


    //            var HOY1 = api
    //                .column(4)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY2 = api
    //                .column(5)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);
    //            var HOY3 = api
    //                .column(6)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);
    //            var HOY3 = api
    //                .column(7)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY4 = api
    //                .column(8)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY5 = api
    //                .column(9)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY6 = api
    //                .column(10)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY7 = api
    //                .column(11)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY8 = api
    //                .column(12)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY9 = api
    //                .column(13)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY10 = api
    //                .column(14)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);

    //            var HOY11 = api
    //                .column(15)
    //                .data()
    //                .reduce(function (a, b) {
    //                    return intVal(a) + intVal(b);
    //                }, 0);


    //            const formateador = new Intl.NumberFormat("en", { style: "currency", "currency": "GTQ" });


    //            $(api.column(0).footer()).html('Total');
    //            $(api.column(3).footer()).html(HOY);
    //            $(api.column(4).footer()).html(HOY1);
    //            $(api.column(5).footer()).html(HOY2);
    //            $(api.column(6).footer()).html(HOY3);
    //            $(api.column(7).footer()).html(HOY4);
    //            $(api.column(8).footer()).html(HOY5);
    //            $(api.column(9).footer()).html(HOY6);
    //            $(api.column(10).footer()).html(HOY7);
    //            $(api.column(11).footer()).html(HOY8);
    //            $(api.column(12).footer()).html(HOY9);
    //            $(api.column(13).footer()).html(HOY10);
    //            $(api.column(14).footer()).html(HOY11);


    //        },
    //        destroy: true,
    //        dom: 'Bfrtip',
    //        //buttons: [
    //        //    {
    //        //        extend: 'print',
    //        //        text: 'Imprimir Reporte',
    //        //        exportOptions: {
    //        //            columns: ':visible',
    //        //        }
    //        //    },
    //        //    'colvis'
    //        //],

    //        language: {
    //            "decimal": "",
    //            "emptyTable": "No hay información",
    //            "info": "Mostrando registros de _START_ al _END_ de un total de  _TOTAL_ registros",
    //            "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
    //            "infoFiltered": "(filtrado de un total de _MAX_ registros)",
    //            "infoPostFix": "",
    //            "thousands": ",",
    //            "lengthMenu": "Mostrar _MENU_ Entradas",
    //            "loadingRecords": "Cargando...",
    //            "processing": "Procesando...",
    //            "search": "Buscar:",
    //            "searchPlaceholder": "Buscar registros",
    //            "zeroRecords": "Sin resultados encontrados",
    //            "paginate": {
    //                "first": "Primero",
    //                "last": "Ultimo",
    //                "next": "Siguiente",
    //                "previous": "Anterior"
    //            }
    //        },
    //        columnDefs: [{
    //            visible: false
    //        }],
    //        //responsive: true,
    //        pageLength: 100

    //    });

    //}
</script>